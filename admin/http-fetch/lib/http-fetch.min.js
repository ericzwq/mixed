function asyncGeneratorStep(e,t,n,r,o,a,s){try{var u=e[a](s),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function s(e){asyncGeneratorStep(a,r,o,s,u,"next",e)}function u(e){asyncGeneratorStep(a,r,o,s,u,"throw",e)}s(void 0)}))}}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}!function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).HttpFetch={})}(this,(function(e){"use strict";function t(e,t,r,o){return function(e,t,n){for(var r=!1,o=!1,a=function(a){var s=t[a];"function"==typeof s&&(r=!0);var u=t[a+1];e=e.then((function(e){return"function"==typeof s?o?s(e,e&&e.response,n):(o=!0)&&s(e.data,e.response,n):e}),u)},s=0;s<t.length;s+=2)a(s);return r?e:e.then((function(e){return e.data}))}(n(Promise.resolve(o),e).then((function(e){return t(o=e)})),r,o)}function n(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return r===t.length?e:n(e.then(t[r],t[r+1]),t,r+2)}var r;!function(e){e.json="application/json",e.formData="multipart/form-data",e.urlencoded="application/x-www-from-urlencoded",e.text="text/plain"}(r||(r={}));var o="production"===process.env.NODE;function a(e){if("object"!==_typeof(e))return e;if(Array.isArray(e))return e.map(a);var t={};return Object.keys(e).forEach((function(n){return t[n]=a(e[n])})),t}function s(e,t){var n=u(t);return e+((n="&"===n[0]?n.slice(1):n)?(e.lastIndexOf("?")>-1?"&":"?")+n:"")}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return"object"===_typeof(e)?null!=e?Object.keys(e).reduce((function(t,n){return t+(null!=e[n]?"&"+n+"="+u(e[n]):"")}),t):t:t+e}function c(e){return Object.prototype.toString.call(e).slice(8,-1)}function i(e,t,n,r){t.config=n,t.response=r,r?r.text().then((function(n){try{n=JSON.parse(n)}catch(e){}t.data=n,e(t)})):e(t)}function f(e){!o&&e.signal&&console.error("[HttpFetch warn]: If you want to abort request, please use controller instead signal."),e.method&&(e.method=e.method.toUpperCase());var t=e.controller||new AbortController;e.signal=t.signal;var n=""+e.url;n.startsWith("http")||n.startsWith("//")||!e.base||(n=e.base+n);var a=e.data,u=e.params;if(null!=u&&(n=s(n,u)),null!=a)if(["Object","Array","Boolean","Number"].includes(c(a)))if(e.body=JSON.stringify(a),e.headers)if("Object"===c(e.headers))e.headers["Content-Type"]||(e.headers["Content-Type"]=r.json);else if(e.headers instanceof Headers)e.headers.has("Content-Type")||e.headers.set("Content-Type",r.json);else if(Array.isArray(e.headers)){e.headers.find((function(e){return"content-type"===e[0].toLowerCase()}))||e.headers.push(["Content-Type",r.json])}else o||console.error('[HttpFetch warn]: The config headers is invalid, you can set {}, [["Content-Type", "application/json"]], or a instance of Headers');else e.headers={"Content-Type":r.json};else e.body=a;return new Promise(function(){var r=_asyncToGenerator(regeneratorRuntime.mark((function r(o,a){var s,u,c,f,l;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,e.timeout&&setTimeout((function(){return p(t,a,e)}),e.timeout),r.next=4,fetch(n,e);case 4:if((s=r.sent).ok){r.next=7;break}return r.abrupt("return",i(a,new Error("Fetch failed with status "+s.status),e,s));case 7:if(s.body){r.next=9;break}return r.abrupt("return",o({data:null,response:new Response}));case 9:u=s.body.getReader(),c=+(s.headers.get("Content-Length")||0),f={total:c,loaded:0},l=new ReadableStream({start:function(){var t=_asyncToGenerator(regeneratorRuntime.mark((function t(n){var r,c,p,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0;case 1:return t.next=4,u.read();case 4:if(r=t.sent,c=r.done,p=r.value,!c){t.next=9;break}return t.abrupt("break",14);case 9:n.enqueue(p),f.loaded+=p.length,e.onDownloadProgress&&e.onDownloadProgress(f),t.next=1;break;case 14:t.next=19;break;case 16:return t.prev=16,t.t0=t.catch(0),t.abrupt("return",i(a,t.t0,e));case 19:if(n.close(),"stream"!==e.responseType){t.next=22;break}return t.abrupt("return",o({data:l,response:s}));case 22:if(t.prev=22,!["json","blob","text","arrayBuffer","formData"].includes(e.responseType)){t.next=29;break}return t.next=26,new Response(l)[e.responseType]();case 26:d=t.sent,t.next=33;break;case 29:return t.next=31,new Response(l).text();case 31:d=t.sent;try{d=JSON.parse(d)}catch(e){}case 33:t.next=38;break;case 35:return t.prev=35,t.t1=t.catch(22),t.abrupt("return",i(a,new Error("Response parse error"),e));case 38:o({data:d,response:s});case 39:case"end":return t.stop()}}),t,null,[[0,16],[22,35]])})));return function(e){return t.apply(this,arguments)}}()}),r.next=18;break;case 15:r.prev=15,r.t0=r.catch(0),i(a,r.t0,e);case 18:case"end":return r.stop()}}),r,null,[[0,15]])})));return function(e,t){return r.apply(this,arguments)}}())}function p(e,t,n){e.abort(),i(t,new Error("Timeout of ".concat(n.timeout,"ms exceeded")),n)}function l(e){var n,r=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n="string"==typeof e?e:(o=e).url,Object.keys(this.config).forEach((function(e){return e in o?0:o[e]=a(r.config[e])})),o.url=n,t(this.interceptors.request.handlers,f,this.interceptors.response.handlers,o)}var d=function e(t,n){return l.call(e,t,n)};d.config={},d.interceptors={request:{use:function(e,t){return this.handlers.push(e,t)},handlers:[]},response:{use:function(e,t){return this.handlers.push(e,t)},handlers:[]}},d.create=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=function e(t,n){return l.call(e,t,n)};return Object.keys(this).forEach((function(t){if("create"!==t){var r=e[t];n[t]=r}})),Object.keys(this.config).forEach((function(n){return n in t?0:t[n]=a(e.config[n])})),n.config=t,n},["post","put","patch"].forEach((function(e){d[e]=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r.method=e,r.data=n,l.call(this,t,r)}})),["get","delete","options","head"].forEach((function(e){d[e]=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r.method=e,r.params=n,l.call(this,t,r)}})),e.default=d,Object.defineProperty(e,"__esModule",{value:!0})}));

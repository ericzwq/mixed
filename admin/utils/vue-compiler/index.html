<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
</head>
<!--< div>>-->
<div></div>
<hr/>
<script>

  function BuildNext(P, Next) {
    let m = P.length;
    let t = Next[0] = -1;
    let j = 0;
    while (j < m - 1) {
      if (t < 0 || P[j] === P[t]) {
        j++;
        t++;
        Next[j] = t;//待优化
      } else t = Next[t];
    }
  }

  function KMP(a, b) {
    let Next = new Array(b.length)
    BuildNext(b, Next);//用来求Next数组
    let n = a.length;
    let m = b.length;
    let i = 0, j = 0;
    while (j < m && i < n) {
      if (j < 0 || a[i] === b[j])
        i++, j++;
      else j = Next[j];
    }
    return i - j;
  }

  test()

  function test() {
    // console.log(indexOf('abaeaba', ''));
// let s = 'aabstaabdeaabstaabe', t = Date.now()
    let s = 'aaabbbcccssaaabbbcccsssdddeeevvssaaaddbbbccccddddggggaaaaabbbbbbbbbbaaaaaaaaaaaddddddddffffffffeeeffffffffdffffffffy',
      t = Date.now(),
      l = s.length
    for (let i = 0; i < 1000000; i++) {
      let r1 = Math.floor(Math.random() * l), r2 = r1 + l - Math.floor(Math.random() * (l)), sub = s.slice(r1, r2)
      // if (kmpSearch(s, sub) !== s.indexOf(sub)) {
      //   console.log(i, r1, r2, sub, s.indexOf(sub), kmpSearch(s, sub))
      //   break
      // }
      KMP(s, sub)
    }
    console.log(Date.now() - t)
  }
</script>
<!--<script src="index.js"></script>-->
</body>
</html>
